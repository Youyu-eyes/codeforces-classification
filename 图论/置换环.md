
# 置换环问题
我们考虑一个长度为 L 的置换环（cycle）。我们要通过交换操作将它分解成若干个长度为 1 或 2 的环，并证明最少需要 (L-1)//2 次交换。

## 环的结构与交换操作
一个长度为 L 的环可以表示为：

a₁ → a₂ → a₃ → ... → a_L → a₁
其中每个箭头表示映射关系：p[a_i] = a_{i+1}，且 p[a_L] = a₁。

每次交换操作可以交换任意两个位置的元素。注意：交换元素会改变环的结构。

### 目标与约束
我们需要最终每个环的长度 ≤ 2。一个长度为 1 的环是自环（p[i] = i），长度为 2 的环是互逆对（p[i] = j, p[j] = i）。

### 下界证明
设最终我们将长度为 L 的环分解成了 k 个长度 ≤ 2 的环。那么：

每个长度为 1 的环包含 1 个元素。

每个长度为 2 的环包含 2 个元素。

总元素数为 L。

因此，最终环的个数 k 至少为 ⌈L/2⌉（因为最多每两个元素构成一个环）。

初始时只有 1 个环，最终要有 k 个环。每次交换最多能增加一个环的数量（因为交换可以将一个环拆分成两个环）。因此，至少需要 k - 1 次交换。

所以，最少交换次数 ≥ ⌈L/2⌉ - 1。

由于 ⌈L/2⌉ - 1 = (L-1)//2（可以通过分奇偶验证），所以我们得到了下界 (L-1)//2。

### 构造性证明（上界）
现在我们证明可以通过 (L-1)//2 次交换达到目标。我们给出一种具体的交换策略：

#### 情况 1：L 为偶数
我们可以将环分解成 L/2 个长度为 2 的环。

##### 构造方法：
对于环 (a₁ a₂ a₃ ... a_L)，我们进行如下交换：

交换 a₁ 和 a₂。

交换后，a₁ 和 a₂ 形成一个长度为 2 的环。

剩下的元素 a₃, a₄, ..., a_L 形成一个长度为 L-2 的环。

对剩下的长度为 L-2 的环重复此过程。

每次交换将一个环拆成一个长度为 2 的环和一个长度减 2 的环。经过 L/2 - 1 次交换后，我们得到 L/2 个长度为 2 的环。

交换次数 = L/2 - 1 = (L-2)/2 = (L-1)//2（因为 L 是偶数时，(L-1)//2 = L/2 - 1）。

#### 情况 2：L 为奇数
我们需要分解成 (L-1)/2 个长度为 2 的环和 1 个长度为 1 的环。

##### 构造方法：

交换 a₁ 和 a₂。

交换后，a₁ 和 a₂ 形成一个长度为 2 的环。

剩下的元素 a₃, a₄, ..., a_L 形成一个长度为 L-2 的环（此时 L-2 为奇数）。

继续对剩下的环进行类似操作，每次交换产生一个长度为 2 的环，直到剩下一个长度为 3 的环。

对于长度为 3 的环 (x y z)，交换 x 和 y 会产生一个自环和一个长度为 2 的环：

交换后，x 变成自环（p[x] = x），y 和 z 形成一个长度为 2 的环。

## 总交换次数：

对于长度为 L 的奇环，我们首先交换一次得到长度为 2 的环和一个长度为 L-2 的奇环。

然后重复此过程，直到长度为 3。

最终，交换次数 = (L-3)/2 + 1 = (L-1)/2 = (L-1)//2。

## 总结
我们证明了：

下界：至少需要 (L-1)//2 次交换。

上界：存在一种方法只需要 (L-1)//2 次交换。

因此，将一个长度为 L 的环分解成长度为 1 或 2 的环的最小交换次数就是 (L-1)//2。